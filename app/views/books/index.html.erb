<% if @user %>
  <% rss user_books_path(@user, :rss) %>
<% else %>
  <% rss books_path(:rss) %>
<% end %>

<% if current_user %>
  <% title current_user.name %>
<% else %>
  <% title "Bibliotecas Autonomas Unificadas" %>
<% end %>

<% if @user %>
  <%= render :partial => "user_books_search" %>
<% else %>
  <%= render :partial => "books_search" %>
<% end %>

<p id="total">
  <%= @total %> itens encontrados
</p>

<ul id="books">
  <% for book in @books %>
    <% if book %>
      <li>
        <%= link_to index_label(book), user_book_path(book.user, book), :class => 'index_title' %>
          <span class="index_edit">
            <% if can? :update, book %>
              <%= link_to "Editar", edit_user_book_path(book.user, book), :class => "edit_link" %>
            <% end %>
            <% if can? :destroy, book %>
              <%= button_to "Remover", [book.user, book], :confirm => 'Tem certeza?', :method => :delete, :class => 'remove_button' %>
            <% end %>
          </span>
        <br/>
        <span class="index_author"><%= book.authors_names %></span>
        <% if book.year && book.year > 0 %>
          <span class="index_year"><%= book.year %></span>
        <% end %>
      </li>
    <% end %>
  <% end %>
</ul>

<%= paginate @books %>  

<% if current_user %>
  <div id="admin">
    <% if can? :create, Book.new %>
        <%= link_to "Novo Livro", new_user_book_path(current_user) %> |
    <% end %>     
    <%= link_to "Deslogar", :controller => 'sessions', :action => 'destroy' %>
  </div>
<% end %>  

